<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°¿å±±è¡Œæ—…å¤§å¯Œç¿ - åç•«å‘¨é‚Šç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Serif TC', serif;
            background-color: #e8e2d6;
            color: #2c2c2c;
            overflow: hidden;
            background-image: radial-gradient(#d4cdbc 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(6, 1fr);
            width: 95vw;
            max-width: 650px;
            height: 95vw;
            max-height: 650px;
            border: 8px solid #3e2723;
            background-color: #fdfbf7;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .cell {
            border: 1px solid #c7bda8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            font-size: 0.7rem;
            padding: 4px;
            text-align: center;
            position: relative;
            overflow: hidden;
            background-color: #f5f1e8;
        }

        /* æ¨¡æ“¬ç•«ä½œå±€éƒ¨èƒŒæ™¯ */
        .cell-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 65%;
            background-size: cover;
            background-position: center;
            opacity: 0.7;
            filter: sepia(0.3) contrast(1.1);
            border-bottom: 1px solid #d7ccc8;
        }

        .center-art {
            grid-column: 2 / 6;
            grid-row: 2 / 6;
            background-color: #d9d2c5;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px double #5d4037;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .center-art img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
        }

        .player {
            width: 34px;
            height: 34px;
            background: #b71c1c;
            border: 2px solid #fdfbf7;
            border-radius: 50%;
            position: absolute;
            z-index: 50;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .dice-area {
            background: #3e2723;
            color: #d7ccc8;
            padding: 15px 25px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .dice-btn {
            background: #8d6e63;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #5d4037;
        }

        .dice-btn:active { transform: scale(0.9); }
        .dice-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .status-bar {
            width: 100%;
            max-width: 650px;
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
            color: #5d4037;
        }

        .log-container {
            width: 100%;
            max-width: 650px;
            background: rgba(62, 39, 35, 0.05);
            border-left: 4px solid #3e2723;
            padding: 8px 15px;
            height: 60px;
            overflow-y: auto;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        .stamp-badge {
            display: inline-block;
            padding: 2px 8px;
            border: 1px solid #b71c1c;
            color: #b71c1c;
            font-size: 10px;
            border-radius: 2px;
            margin-top: 2px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .highlight { animation: pulse 1s infinite; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-2">

    <h1 class="text-3xl font-bold mb-4 tracking-widest text-[#3e2723]">è°¿å±±è¡Œæ—… Â· å¤§å¯Œç¿</h1>
    
    <div class="status-bar">
        <div id="stamps-display" class="flex gap-2">
            å°è¨˜: <span id="stamp-icons">ğŸ”˜ğŸ”˜ğŸ”˜ğŸ”˜</span>
        </div>
        <div id="steps-display">é¤˜æ­¥: <span id="steps-val" class="text-red-700">18</span></div>
    </div>

    <div class="board" id="board">
        <!-- ä¸­å¤®ä¸»åœ– -->
        <div class="center-art">
            <div class="absolute inset-0 bg-[#c9c0ae] p-6 flex flex-col justify-between border-4 border-[#5d4037]">
                <div class="text-center">
                    <h2 class="text-2xl font-bold mb-1 underline decoration-double">è°¿å±±è¡Œæ—…åœ–</h2>
                    <p class="text-xs italic leading-relaxed">åŒ—å®‹ Â· èŒƒå¯¬</p>
                </div>
                <div class="flex-grow flex items-center justify-center">
                    <!-- æ¨¡æ“¬ä¸»å±±å·å³¨çš„æ„è±¡ -->
                    <div class="w-24 h-48 bg-[#4e342e] rounded-t-full opacity-20 relative">
                        <div class="absolute bottom-0 w-full h-1/2 bg-[#5d4037] opacity-40"></div>
                    </div>
                </div>
                <div class="flex justify-between items-end">
                    <div class="text-[10px] text-[#5d4037] w-2/3">å·¨ç¢‘æ§‹åœ– Â· é›¨é»çš´æ³• Â· å¸«æ³•é€ åŒ–</div>
                    <div class="border-2 border-red-800 p-1 text-red-800 font-bold text-xs">èŒƒå¯¬</div>
                </div>
            </div>
        </div>

        <div id="player" class="player">æ—…</div>
    </div>

    <div class="log-container" id="log">
        <p>> é»æ“Šå³ä¸‹è§’æŒ‰éˆ•æ“²éª°å­ï¼Œå±•é–‹ 5 åˆ†é˜çš„å‚³ä¸–ä¹‹æ—…...</p>
    </div>

    <div class="mt-6 dice-area">
        <div class="text-sm font-bold">æ“²éª°è¡Œæ—…</div>
        <button id="dice-btn" class="dice-btn">ğŸ²</button>
        <div id="dice-result" class="text-3xl font-black w-8"></div>
    </div>

    <!-- äº‹ä»¶å½ˆçª— -->
    <div id="modal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center z-[100] p-6 backdrop-blur-sm">
        <div class="bg-[#fdfbf7] border-4 border-[#3e2723] p-8 rounded-sm max-w-sm w-full shadow-2xl relative">
            <div class="absolute top-2 right-2 border border-red-800 text-red-800 text-[10px] px-1 font-bold">ä¹¾éš†å¾¡è¦½</div>
            <h2 id="modal-title" class="text-2xl font-bold mb-4 text-[#3e2723] border-b-2 border-[#d7ccc8] pb-2"></h2>
            <p id="modal-desc" class="mb-6 leading-relaxed text-[#5d4037] text-lg"></p>
            <button id="modal-close" class="w-full bg-[#3e2723] text-[#d7ccc8] py-3 font-bold hover:bg-[#5d4037] transition-colors">é ˜æ—¨</button>
        </div>
    </div>

    <script>
        const boardSize = 6;
        const cellsData = [
            { name: "è¡Œæ—…èµ·é»", type: "start", img: "ğŸ®", desc: "èƒŒèµ·è¡Œå›Šï¼Œæ­¥å…¥çµ‚å—å±±ã€‚" },
            { name: "è·¯å´è»Šé¦¬", type: "normal", img: "ğŸ", desc: "è¦‹è»Šé¦¬ç´†è¡Œï¼Œæ„Ÿå—è¶•è·¯ä¹‹è‰±ã€‚" },
            { name: "é›¨é»çš´", type: "event", desc: "é ˜ç•¥èŒƒå¯¬ç¨ç‰¹çš´æ³•ï¼Œç­†å‹¢é›„åšã€‚" },
            { name: "å±±å‡¹è˜­è‹¥", type: "stamp", img: "ğŸ¯", desc: "å°‹å¾—æ·±å±±è˜­è‹¥ï¼Œç²ã€è˜­è‹¥å°è¨˜ã€‘ã€‚" },
            { name: "æ’²äººçœ‰å®‡", type: "event", desc: "å·¨å±±æ’²é¢è€Œä¾†ï¼Œç²¾ç¥ç‚ºä¹‹éœ‡æ’¼ã€‚" },
            { name: "é£›ç€‘é›²é¨°", type: "stamp", img: "ğŸŒŠ", desc: "ä¸€ç·šé£›ç€‘ç›´ä¸‹ï¼Œç²ã€é£›ç€‘å°è¨˜ã€‘ã€‚" },
            { name: "å¸«æ³•é€ åŒ–", type: "event", desc: "ä¸è‹¥å¸«è«¸é€ åŒ–ï¼Œå‰é€² 2 æ­¥ã€‚" },
            { name: "çŸ³æ¸ å¯¶ç¬ˆ", type: "normal", img: "ğŸ“œ", desc: "åç•«å…¥è—ï¼Œçš‡å®¶æ°£è±¡ã€‚" },
            { name: "èŒƒå¯¬æ¬¾è­˜", type: "stamp", img: "âœï¸", desc: "æ¨¹è”­ä¸‹ç™¼ç¾æ¬¾æ›¸ï¼Œç²ã€åæ¬¾å°è¨˜ã€‘ã€‚" },
            { name: "è‘£å…¶æ˜Œé¡Œ", type: "event", desc: "å¤§å¸«è©•é»ï¼Œæ™ºæ…§å¤§å¢ã€‚" },
            { name: "å±¤å·’ç–Šå¶‚", type: "stamp", img: "â›°ï¸", desc: "ä¸»å±±å·å³¨ï¼Œç²ã€å·¨å±±å°è¨˜ã€‘ã€‚" },
            { name: "éœ§æ°£è¿·æ¼«", type: "trap", desc: "é›²éœ§é®çœ¼ï¼Œæ­¥å±¥ç¶­è‰±ï¼ˆé¤˜æ­¥-1ï¼‰ã€‚" },
            { name: "è¡Œæ—…é©¢éšŠ", type: "normal", img: "ğŸ«", desc: "æ¸…è„†éˆ´è²ï¼Œè¿´ç›ªå±±è°·ã€‚" },
            { name: "çµ‚å—å¤ªè¯", type: "event", desc: "éè§€å¥‡å‹ï¼Œæµé€£å¿˜è¿”ã€‚" },
            { name: "ç­†å¢¨è’¼å‹", type: "normal", img: "ğŸ–Œï¸", desc: "æ„Ÿå—å¢¨è‰²æ·‹æ¼“çš„éœ‡æ’¼ã€‚" },
            { name: "å¸«ææˆ", type: "event", desc: "å­¸å‰äººåŸºç¤ï¼Œæ ¹åŸºç©©å›ºã€‚" },
            { name: "æºªæµæ½ºæ½º", type: "normal", img: "ğŸ’§", desc: "æºªæ°´æ´—æ»Œè¡Œæ—…çš„å¡µåŸƒã€‚" },
            { name: "å¢¨è‰²æ·‹æ¼“", type: "event", desc: "æ¿ƒæ·¡ä¹¾æ¿•ï¼Œç›¡é¡¯ç¥éŸ»ã€‚" },
            { name: "ç•«æ°£æ’²é¢", type: "normal", img: "ğŸ’¨", desc: "å¦‚è‡¨å…¶å¢ƒçš„å£¯ç¢©ç¾æ„Ÿã€‚" },
            { name: "æŠµé”çµ‚é»", type: "end", img: "ğŸ†", desc: "å®Œæˆäº†ä¸€å ´è·¨è¶Šåƒå¹´çš„è¡Œæ—…ã€‚" }
        ];

        let playerPos = 0;
        let stamps = new Set();
        let stepsLeft = 18;
        let isGameOver = false;

        const boardEl = document.getElementById('board');
        const playerEl = document.getElementById('player');
        const logEl = document.getElementById('log');
        const diceBtn = document.getElementById('dice-btn');
        const diceResultEl = document.getElementById('dice-result');
        const stampIconsEl = document.getElementById('stamp-icons');
        const stepsValEl = document.getElementById('steps-val');

        function getCellCoords(index) {
            if (index < 6) return { r: 1, c: index + 1 };
            if (index < 10) return { r: index - 4, c: 6 };
            if (index < 15) return { r: 6, c: 16 - index };
            return { r: 21 - index, c: 1 };
        }

        function createBoard() {
            cellsData.forEach((data, i) => {
                const coords = getCellCoords(i);
                const cell = document.createElement('div');
                cell.className = `cell ${data.type === 'stamp' ? 'bg-[#efebe9]' : ''}`;
                cell.style.gridRow = coords.r;
                cell.style.gridColumn = coords.c;
                
                const bg = document.createElement('div');
                bg.className = 'cell-bg';
                // ä½¿ç”¨ Emoji æˆ–é¡è‰²æ¨¡æ“¬å±€éƒ¨ç•«é¢
                bg.innerHTML = `<div class="w-full h-full flex items-center justify-center text-xl opacity-30 grayscale">${data.img || 'ğŸ”ï¸'}</div>`;
                cell.appendChild(bg);

                const label = document.createElement('div');
                label.className = 'font-bold relative z-10 text-[9px] leading-tight';
                label.innerText = data.name;
                cell.appendChild(label);

                if (data.type === 'stamp') {
                    const badge = document.createElement('div');
                    badge.className = 'stamp-badge font-bold';
                    badge.innerText = 'å°‹å°';
                    cell.appendChild(badge);
                }

                boardEl.appendChild(cell);
            });
            updatePlayerVisual();
        }

        function updatePlayerVisual() {
            const coords = getCellCoords(playerPos);
            const boardRect = boardEl.getBoundingClientRect();
            const cellSize = boardRect.width / 6;
            playerEl.style.top = `${(coords.r - 1) * cellSize + cellSize / 2 - 17}px`;
            playerEl.style.left = `${(coords.c - 1) * cellSize + cellSize / 2 - 17}px`;
        }

        function addLog(msg) {
            const p = document.createElement('p');
            p.innerText = `> ${msg}`;
            logEl.prepend(p);
        }

        function showModal(title, desc, isSuccess = false) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-desc').innerText = desc;
            document.getElementById('modal').classList.remove('hidden');
            if (isSuccess) document.getElementById('modal-title').classList.add('text-red-800');
        }

        document.getElementById('modal-close').onclick = () => {
            document.getElementById('modal').classList.add('hidden');
            if(isGameOver) location.reload();
        };

        diceBtn.onclick = () => {
            if (isGameOver) return;
            diceBtn.disabled = true;

            const roll = Math.floor(Math.random() * 6) + 1;
            diceResultEl.innerText = roll;
            stepsLeft--;
            stepsValEl.innerText = stepsLeft;
            
            // æ£‹ç›¤å‹•ç•«
            let stepsMoved = 0;
            const moveInterval = setInterval(() => {
                playerPos = (playerPos + 1) % cellsData.length;
                updatePlayerVisual();
                stepsMoved++;
                if (stepsMoved === roll) {
                    clearInterval(moveInterval);
                    handleCellArrival();
                }
            }, 150);
        };

        function handleCellArrival() {
            const cell = cellsData[playerPos];
            addLog(`æ—…äººç§»è‡³ã€${cell.name}ã€‘`);

            setTimeout(() => {
                if (cell.type === 'stamp') {
                    if (!stamps.has(cell.name)) {
                        stamps.add(cell.name);
                        updateStampIcons();
                        showModal("å¾—å¤§ä½œç²¾é«“", cell.desc, true);
                    } else {
                        addLog("æ­¤è™•å¢¨è·¡å·²ç„¶é ˜ç•¥ã€‚");
                    }
                } else if (cell.type === 'event') {
                    if (cell.name === "å¸«æ³•é€ åŒ–") {
                        playerPos = (playerPos + 2) % cellsData.length;
                        setTimeout(updatePlayerVisual, 300);
                        addLog("é«”æ‚Ÿé€ åŒ–ï¼Œè¡Œé€²ç¥é€Ÿï¼");
                    }
                    showModal("å±±é–“å¥‡é‡", cell.desc);
                } else if (cell.type === 'trap') {
                    stepsLeft--;
                    stepsValEl.innerText = stepsLeft;
                    showModal("è·¯é€”è‰±éšª", cell.desc);
                }

                checkGameState();
                diceBtn.disabled = false;
            }, 300);
        }

        function updateStampIcons() {
            let icons = "";
            for(let i=1; i<=4; i++) {
                icons += stamps.size >= i ? "ğŸ”´" : "ğŸ”˜";
            }
            stampIconsEl.innerText = icons;
            if(stamps.size === 4) stampIconsEl.classList.add('highlight');
        }

        function checkGameState() {
            if (playerPos === cellsData.length - 1 && stamps.size >= 4) {
                isGameOver = true;
                showModal("è¡Œæ—…åœ“æ»¿", "ä½ é›†é½Šäº†ã€Šè°¿å±±è¡Œæ—…åœ–ã€‹çš„æ‰€æœ‰ç¥éŸ»ï¼Œé«”æœƒäº†èŒƒå¯¬å¸«æ³•é€ åŒ–çš„çœŸæ„ï¼Œå®Œæˆäº†ä¸€æ¬¡å‰å¤§çš„è—è¡“å·¡ç¦®ï¼");
            } else if (stepsLeft <= 0) {
                isGameOver = true;
                showModal("ç²¾åŠ›æ•£ç›¡", "å±±è·¯å´å¶‡ï¼Œæ—…äººé«”åŠ›ä¸æ”¯ã€‚é›–ç„¶éºæ†¾ï¼Œä½†å±±æ°´ä¹‹è¶£å·²ç•™å¿ƒä¸­ã€‚");
            }
        }

        window.onload = createBoard;
        window.onresize = updatePlayerVisual;
    </script>
</body>
</html>
